"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[4586],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},i={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),f=u(n),m=a,d=f["".concat(s,".").concat(m)]||f[m]||i[m]||o;return n?r.createElement(d,c(c({ref:t},p),{},{components:n})):r.createElement(d,c({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=f;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,c[1]=l;for(var u=2;u<o;u++)c[u]=n[u];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},5398:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return i}});var r=n(3117),a=n(102),o=(n(7294),n(3905)),c=["components"],l={},s="Effect Hook",u={unversionedId:"You-Dont-Know-React/React Hook/Effect Hoo 6663b",id:"You-Dont-Know-React/React Hook/Effect Hoo 6663b",title:"Effect Hook",description:"\u6982\u5ff5",source:"@site/docs/You-Dont-Know-React/React Hook/Effect Hoo 6663b.md",sourceDirName:"You-Dont-Know-React/React Hook",slug:"/You-Dont-Know-React/React Hook/Effect Hoo 6663b",permalink:"/docs/You-Dont-Know-React/React Hook/Effect Hoo 6663b",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Props",permalink:"/docs/You-Dont-Know-React/Props 470ef"},next:{title:"Hook \u4f7f\u7528\u89c4\u5219",permalink:"/docs/You-Dont-Know-React/React Hook/Hook \u4f7f\u7528\u89c4\u5219 16983"}},p={},i=[{value:"\u6982\u5ff5",id:"\u6982\u5ff5",level:3},{value:"<strong>effect \u7684\u6267\u884c\u65f6\u673a</strong>",id:"effect-\u7684\u6267\u884c\u65f6\u673a",level:3},{value:"<strong>effect \u7684\u6761\u4ef6\u6267\u884c</strong>",id:"effect-\u7684\u6761\u4ef6\u6267\u884c",level:3},{value:"<strong>\u65e0\u9700\u6e05\u9664\u7684 effect</strong>",id:"\u65e0\u9700\u6e05\u9664\u7684-effect",level:3},{value:"<strong>\u6e05\u9664 effect</strong>",id:"\u6e05\u9664-effect",level:3},{value:"<strong>\u4f7f\u7528 Effect \u7684\u63d0\u793a</strong>",id:"\u4f7f\u7528-effect-\u7684\u63d0\u793a",level:3}],f={toc:i};function m(e){var t=e.components,n=(0,a.Z)(e,c);return(0,o.kt)("wrapper",(0,r.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"effect-hook"},"Effect Hook"),(0,o.kt)("h3",{id:"\u6982\u5ff5"},"\u6982\u5ff5"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Effect Hook")," \u9700\u8981\u5728\u6e32\u67d3\u540e\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c\uff0c\u6539\u53d8 DOM\u3001\u6dfb\u52a0\u8ba2\u9605\u3001\u8bbe\u7f6e\u5b9a\u65f6\u5668\u3001\u8bb0\u5f55\u65e5\u5fd7\u4ee5\u53ca\u6267\u884c\u5176\u4ed6\u5305\u542b\u526f\u4f5c\u7528\u7684\u64cd\u4f5c\uff08",(0,o.kt)("inlineCode",{parentName:"p"},"componentDidMount"),"\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"componentDidUpdate")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"componentWillUnmount"),"\uff09"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"useEffect(didUpdate);\n")),(0,o.kt)("h3",{id:"effect-\u7684\u6267\u884c\u65f6\u673a"},(0,o.kt)("strong",{parentName:"h3"},"effect \u7684\u6267\u884c\u65f6\u673a")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u4f20\u7ed9 ",(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")," \u7684\u51fd\u6570render\u4e4b\u540e\u6267\u884c"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")," \u7b2c\u4e00\u6b21render\u6e32\u67d3\u4e4b\u540e\u548c\u6bcf\u6b21\u66f4\u65b0\u4e4b\u540e\u90fd\u4f1a\u6267\u884c\uff0c\u4e3a\u4e86\u89e3\u51b3\u6ca1\u6709\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"li"},"componentDidUpdate"),"\u5f15\u53d1\u7684\u95ee\u9898"),(0,o.kt)("li",{parentName:"ul"},"\u7279\u6b8a\u60c5\u51b5",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u7528\u6237\u64cd\u4f5c\u4e8b\u4ef6\u548c",(0,o.kt)("inlineCode",{parentName:"li"},"[flushSync](https://zh-hans.reactjs.org/docs/react-dom.html#flushsync)")," \u5305\u88c5\u7684\u66f4\u65b0\u7ed3\u679c\uff0c\u4f20\u9012\u7ed9 ",(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")," \u7684\u51fd\u6570\u5c06\u5728\u5c4f\u5e55\u5e03\u5c40\u548c\u7ed8\u5236\u4e4b\u524d\u540c\u6b65\u6267\u884c","  \u8fd9\u53ea\u5f71\u54cd\u4f20\u9012\u7ed9 ",(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")," \u7684\u51fd\u6570\u88ab\u8c03\u7528\u65f6 \u2014 \u5728\u8fd9\u4e9b effect \u4e2d\u6267\u884c\u7684\u66f4\u65b0\u4ecd\u4f1a\u88ab\u63a8\u8fdf\n")))),(0,o.kt)("h3",{id:"effect-\u7684\u6761\u4ef6\u6267\u884c"},(0,o.kt)("strong",{parentName:"h3"},"effect \u7684\u6761\u4ef6\u6267\u884c")),(0,o.kt)("p",null,"effect \u6240\u4f9d\u8d56\u7684\u503c\u6570\u7ec4"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u7a7a\u6570\u7ec4\uff0c\u53ea\u8fd0\u884c\u4e00\u6b21\u7684 effect\uff08\u4ec5\u5728\u7ec4\u4ef6\u6302\u8f7d\u548c\u5378\u8f7d\u65f6\u6267\u884c\uff09"),(0,o.kt)("li",{parentName:"ul"},"\u6709\u503c\u6570\u7ec4\uff0c\u53ea\u6709\u58f0\u660e\u7684\u53d8\u91cf\u53d8\u5316\u65f6\u624d\u4f1a\u6267\u884c",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"seEffect \u51fd\u6570\u4f7f\u7528\u4e86\u5e76\u4e14\u4f1a\u88ab\u6539\u53d8\uff08\u5305\u62ec props\u3001state\uff0c\u4ee5\u53ca\u4efb\u4f55\u7531\u5b83\u4eec\u884d\u751f\u800c\u6765\u7684\u4e1c\u897f\uff09\uff0c\u624d\u9700\u8981\u653e\u5230 deps \u6570\u7ec4\u4e2d\uff0c\u5426\u5219\u4f60\u7684\u4ee3\u7801\u4f1a\u5f15\u7528\u5230\u5148\u524d\u6e32\u67d3\u4e2d\u7684\u65e7\u53d8\u91cf")))),(0,o.kt)("h3",{id:"\u65e0\u9700\u6e05\u9664\u7684-effect"},(0,o.kt)("strong",{parentName:"h3"},"\u65e0\u9700\u6e05\u9664\u7684 effect")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")," \u653e\u5728\u7ec4\u4ef6\u5185\u90e8\u53ef\u4ee5\u5728 effect \u4e2d\u76f4\u63a5\u8bbf\u95ee  state \u53d8\u91cf\uff08\u6216\u5176\u4ed6 props\uff09","  Hook \u4f7f\u7528\u4e86 JavaScript \u7684\u95ed\u5305\u673a\u5236\n"),(0,o.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u91cd\u65b0\u6e32\u67d3\uff0c\u90fd\u4f1a\u751f\u6210",(0,o.kt)("em",{parentName:"li"},"\u65b0\u7684")," effect"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")," \u4e0d\u4f1a\u963b\u585e\u6d4f\u89c8\u5668\u66f4\u65b0\u5c4f\u5e55")),(0,o.kt)("h3",{id:"\u6e05\u9664-effect"},(0,o.kt)("strong",{parentName:"h3"},"\u6e05\u9664 effect")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"effect")," \u8fd4\u56de\u4e00\u4e2a\u6e05\u9664\u51fd\u6570",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"React \u4f1a\u5728\u7ec4\u4ef6\u5378\u8f7d\u7684\u65f6\u5019\u6267\u884c\u6e05\u9664\u64cd\u4f5c"),(0,o.kt)("li",{parentName:"ul"},"\u8c03\u7528\u4e00\u4e2a\u65b0\u7684 effect \u4e4b\u524d\u6267\u884c\u6e05\u9664\u51fd\u6570\u6e05\u7406\u524d\u4e00\u4e2a effect")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"useEffect(() => {\n  const subscription = props.source.subscribe();\n  return () => {\n    // \u6e05\u9664\u8ba2\u9605\n    subscription.unsubscribe();\n  };\n});\n")),(0,o.kt)("h3",{id:"\u4f7f\u7528-effect-\u7684\u63d0\u793a"},(0,o.kt)("strong",{parentName:"h3"},"\u4f7f\u7528 Effect \u7684\u63d0\u793a")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u591a\u4e2a Effect \u6309\u7167\u4ee3\u7801\u7684\u7528\u9014\u5b9e\u73b0\u5173\u6ce8\u70b9\u5206\u79bb",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function FriendStatusWithCounter(props) {\n  const [count, setCount] = useState(0);\n  useEffect(() => {\n    document.title = `You clicked ${count} times`;\n  });\n  const [isOnline, setIsOnline] = useState(null);\n  useEffect(() => {\n    function handleStatusChange(status) {\n      setIsOnline(status.isOnline);\n    }\n    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n    };\n  });\n}\n"))),(0,o.kt)("li",{parentName:"ul"},"\u6309\u7167 effect \u58f0\u660e\u7684\u987a\u5e8f\u4f9d\u6b21\u8c03\u7528\u7ec4\u4ef6\u4e2d\u7684",(0,o.kt)("em",{parentName:"li"},"\u6bcf\u4e00\u4e2a")," effect",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function App() {\n  useEffect(() => {console.log(1)});\n  useEffect(() => {console.log(2)});\n  useEffect(() => {console.log(3)});\n  return <div />;\n}\n"))),(0,o.kt)("li",{parentName:"ul"},"\u4f9d\u8d56\u5217\u8868",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5728\u4e00\u4e9b\u66f4\u52a0\u590d\u6742\u7684\u573a\u666f\u4e2d\uff08\u6bd4\u5982\u4e00\u4e2a state \u4f9d\u8d56\u4e8e\u53e6\u4e00\u4e2a state\uff09\uff0c\u5c1d\u8bd5\u7528 ",(0,o.kt)("a",{parentName:"li",href:"https://zh-hans.reactjs.org/docs/hooks-reference.html#usereducer"},"useReducer Hook")," \u628a state \u66f4\u65b0\u903b\u8f91\u79fb\u5230 effect \u4e4b\u5916"),(0,o.kt)("li",{parentName:"ul"},"\u4e07\u4e0d\u5f97\u5df2\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4f60\u60f3\u8981\u7c7b\u4f3c class \u4e2d\u7684 this \u7684\u529f\u80fd\uff0c\u4f60\u53ef\u4ee5 ",(0,o.kt)("a",{parentName:"li",href:"https://zh-hans.reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables"},"\u4f7f\u7528\u4e00\u4e2a ref")," \u6765\u4fdd\u5b58\u4e00\u4e2a\u53ef\u53d8\u7684\u53d8\u91cf",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function Example(props) {\n  // \u628a\u6700\u65b0\u7684 props \u4fdd\u5b58\u5728\u4e00\u4e2a ref \u4e2d\n  const latestProps = useRef(props);\n  useEffect(() => {\n    latestProps.current = props;\n  });\n  useEffect(() => {\n    function tick() {\n      // \u5728\u4efb\u4f55\u65f6\u5019\u8bfb\u53d6\u6700\u65b0\u7684 props\n      console.log(latestProps.current);\n    }\n    const id = setInterval(tick, 1000);\n    return () => clearInterval(id);\n  }, []); // \u8fd9\u4e2a effect \u4ece\u4e0d\u4f1a\u91cd\u65b0\u6267\u884c\n}\n"))))),(0,o.kt)("li",{parentName:"ul"},"effect\u548c\u51fd\u6570",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5f53\u51fd\u6570\uff08\u4ee5\u53ca\u5b83\u6240\u8c03\u7528\u7684\u51fd\u6570\uff09  \u4f7f\u7528\u4e86 props\u3001state\uff0c\u4ee5\u53ca\u4efb\u4f55\u7531\u5b83\u4eec\u884d\u751f\u800c\u6765\u7684\u4e1c\u897f\uff0c\u5c31\u628a\u90a3\u4e2a\u51fd\u6570\u79fb\u52a8\u5230\u4f60\u7684 effect ",(0,o.kt)("em",{parentName:"p"},"\u5185\u90e8")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'function ProductPage({ productId }) {\n  const [product, setProduct] = useState(null);\n\n  useEffect(() => {\n    // \u628a\u8fd9\u4e2a\u51fd\u6570\u79fb\u52a8\u5230 effect \u5185\u90e8\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u5b83\u7528\u5230\u7684\u503c\u3002\n    async function fetchProduct() {\n      const response = await fetch("http://myapi/product/" + productId);\n      const json = await response.json();\n      setProduct(json);\n    }\n    fetchProduct();\n  }, [productId]); // \u2705 \u6709\u6548\uff0c\u56e0\u4e3a\u6211\u4eec\u7684 effect \u53ea\u7528\u5230\u4e86 productId  // ...\n}\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u628a\u90a3\u4e2a\u51fd\u6570\u79fb\u52a8\u5230\u4f60\u7684\u7ec4\u4ef6\u4e4b\u5916\uff0c\u4e0d\u7528\u51fa\u73b0\u5728\u4f9d\u8d56\u5217\u8868")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5982\u679c\u4f60\u6240\u8c03\u7528\u7684\u65b9\u6cd5\u662f\u4e00\u4e2a\u7eaf\u8ba1\u7b97\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u6e32\u67d3\u65f6\u8c03\u7528\uff0c\u5728 effect \u4e4b\u5916\u8c03\u7528\u5b83\uff0c \u5e76\u8ba9 effect \u4f9d\u8d56\u4e8e\u5b83\u7684\u8fd4\u56de\u503c")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u4e07\u4e0d\u5f97\u5df2\u7684\u60c5\u51b5\u4e0b\uff0c",(0,o.kt)("a",{parentName:"p",href:"https://zh-hans.reactjs.org/docs/hooks-reference.html#usecallback"},"useCallback")," Hook\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\uff0c\u6dfb\u52a0\u4f9d\u8d56\u5217\u8868\u4f20\u9012\u7ed9\u7ec4\u4ef6\uff0c\u7136\u540e effect \u91cc\u9762\u8c03\u7528\u5b83\u5e76\u4e14\u628a\u8fd9\u4e2a\u51fd\u6570\u4f5c\u4e3a\u4f9d\u8d56\u6570\u7ec4\uff1a"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function ProductPage({ productId }) {\n  // \u2705 \u7528 useCallback \u5305\u88f9\u4ee5\u907f\u514d\u968f\u6e32\u67d3\u53d1\u751f\u6539\u53d8\n  const fetchProduct = useCallback(() => {\n    // ... Does something with productId ...\n  }, [productId]); // \u2705 useCallback \u7684\u6240\u6709\u4f9d\u8d56\u90fd\u88ab\u6307\u5b9a\u4e86\n  return <ProductDetails fetchProduct={fetchProduct} />;\n}\n\nfunction ProductDetails({ fetchProduct }) {\n  useEffect(() => {\n    fetchProduct();\n  }, [fetchProduct]); // \u2705 useEffect \u7684\u6240\u6709\u4f9d\u8d56\u90fd\u88ab\u6307\u5b9a\u4e86\n  // ...\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"effect \u91cc\u9762\u7684\u51fd\u6570\u5305\u542b\u5b9a\u65f6\u5668\uff0c\u4f7f\u7528\u51fd\u6570\u5f0f\u66f4\u65b0state"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function Counter() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      setCount(c => c + 1); // \u2705 This doesn't depend on `count` variable outside    }, 1000);\n    return () => clearInterval(id);\n  }, []); // \u2705 Our effect doesn't use any variables in the component scope\n  return <h1>{count}</h1>;\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"hook\u4f7f\u7528this"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function Example(props) {\n  // Keep latest props in a ref.\n  const latestProps = useRef(props);\n  useEffect(() => {\n    latestProps.current = props;\n  });\n  useEffect(() => {\n    function tick() {\n      // Read latest props at any time\n      console.log(latestProps.current);\n    }\n    const id = setInterval(tick, 1000);\n    return () => clearInterval(id);\n  }, []); // This effect never re-runs\n}\n")))))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.robinwieruch.de/react-hooks-fetch-data/"},"How to fetch data with React Hooks")))}m.isMDXComponent=!0}}]);